<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-93856902-1', 'auto');
  ga('send', 'pageview');

</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '149928278867364',
      cookie     : true,
      xfbml      : true,
      version    : 'v2.8'
    });
    FB.AppEvents.logPageView();

  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));


    function checkLoginState() {
      FB.getLoginStatus(function(response) {
          console.log(response);
      });
    }
</script>
<style>
.progress { position:relative;display:none;border: 1px solid #ddd; padding: 1px; border-radius: 3px; }
.bar { background-color: #B4F5B4; width:0%; height:20px; border-radius: 3px; }
.percent { position:absolute; display:inline-block; top:3px; left:48%; }
.featured{background:rgba(0,0,0,.7)}
.form-fields {
    display: none;
    height: 150vh;
    margin-top: 0;
    padding: 5%;
    color: white;
}
.main {
    /* margin: 0 auto; */
    padding: 0 2em;
}
</style>



<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/1000hz-bootstrap-validator/0.11.9/validator.min.js' type='text/javascript'></script>
<div class='row'>

  <div class='col-12 main'>

      <div class='row featured form-fields' style='display:block;'>
          <h1 class='display-5'> Fill in the form below </h1>
          <div class='col-md-12 col-xs-12'>
            <form action='/upload' method='post' role='form' data-toggle="validator">
              <div class="form-group">
                <label for="name">Song name</label>
                <input name='song'type="text" class="form-control" id="name" aria-describedby="emailHelp" placeholder="Enter song name" required>
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Artist</label>
                <input name='artist' type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="e.g Stunna One Hunna" required>
              </div>
              <div class="form-group">
                <label for="genre">Genre</label>
                <select name='genre' class='form-control'>
                  {{#each genres}}
                  <option id="{{id}}">{{genre}}</option>
                  {{/each}}
                </select>
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Facebook Profile or Page link</label><br/>

                <fb:login-button
                  scope="public_profile,email"
                  onlogin="checkLoginState();">
                </fb:login-button>
                <small> e.g www.facebook.com/manaxv2v </small><br/>
                <small> e.g www.facebook.com/ayabongaqwabi </small><br/>
                &nbsp
                <input name='link' type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="facebook.com/username" required>
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">City</label>
                <input name='location' type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="e.g Queenstown" required>
              </div>
              <div class="form-group">
                <label for="exampleInputFile">Album Art</label>
                <input name='art' type="file" class="form-control-file" id="exampleInputFile" aria-describedby="fileHelp" required>
              </div>
              <div class="form-group">
                <label for="mp3">Song Mp3</label>
                <input name='audio' type="file" class="form-control-file" id="mp3" aria-describedby="fileHelp">
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Cellphone Number</label><br/>
                <small> e.g 0731234567 </small><br/>
                <input name='cellphone' type="number" class="form-control" id="cellphone" aria-describedby="emailHelp" placeholder="Your contact details" required>
              </div>
              <!--
              <div class="form-group">
                <h1 class='display-5'> Artist Code </h1>
                <p> If you already have one just put it in </p>
                <label for="username">If not create your own code</label><br/>
                <small> This is like a password so no one else uploads your songs </small>
                <small> It must have words and numbers. </small><br/>
                <small><b> IT MUST NOT HAVE DATE OF BIRTH NUMBERS<b
                  ><br/>e.g <span style='color:tomato;text-decoration:line-through'>aya1993</span> | <span style='color:tomato;text-decoration:line-through'> 13Panino98 </span>
               </small>
                <br />
                <br />
                <input name='username' type="text" class="form-control" id="username" aria-describedby="emailHelp" placeholder="Your code" required>
              </div>
                !-->
                <input  class="btn btn-warning" type='submit' value="Upload">
                </form>

              <!--
              </div>
             <div class="progress">
                  <div class="bar"></div >
                  <div class="percent">0%</div >
              </div>
              !-->
            <div class="progress col-12">
              <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar"
              aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width:0%">

              </div>
          </div>
          <div id="status"></div>
      </div>

    </div>
  </div>



</div>
<script src="https://malsup.github.com/jquery.form.js"></script>
<script>
var bar = $('.progress-bar');
var percent = $('.percent');
var status = $('#status');
/*$( "form" ).validator();
var bar = $('.progress-bar');
var percent = $('.percent');
var status = $('#status');
var code;
function codeMatch(){
  var bool = code == $('#pin').val()
  console.log('Code match :'+ bool)
  return bool;
}
$( "form" ).submit(function( event ) {
  console.log('submiting')

  if(code){
    console.log('code exista')
    if(codeMatch()){
      console.log('code matches , submiting form')
      return;
    }
    else{
      event.preventDefault();
      console.log('code does not match , alerting')
      alert("Code doesn't match")
    }
  }
  else{
    event.preventDefault();
    console.log('code no exist')
    console.log($('#cellphone').val().split('')[0])
    console.log($('#username').val().length+'  '+$('#cellphone').val().length);
    if($('#cellphone').val().length == 10 && $('#cellphone').val().split('')[0] == '0' && $('#username').val().length >= 5){
        $.get('/generate',function(data){
          console.log('generating code')
            code = data.code;
            console.log('code'+code)
            $('#cellnumber').html($('#cellphone').val())
            $('.hide').toggle()
        })
    }
    else{
        alert('Make sure Cellphone number is correct\n'+' and your Artist Code is 5 characters or more \n')
    }
  }
});*/

$('form').ajaxForm({
    beforeSend: function() {
      $('.progress').css('display','block')
        $('#status').empty();
        var percentVal = '0%';
        bar.width(percentVal)
        percent.html(percentVal);

    },
    uploadProgress: function(event, position, total, percentComplete) {
      //$('.progress').css('display','block')
        var percentVal = percentComplete + '%';
        bar.width(percentVal)
        percent.html(percentVal);

		//console.log(percentVal, position, total);
    },
    success: function() {
        var percentVal = '100%';
        bar.width(percentVal)
        percent.html(percentVal);
    },
	complete: function() {
    $.get('/s/latest/id',function(data){
      var url='/s/'+data.id
      window.location.replace(url)
    })
	}
});
</script>
<script src="js/bootstrap.min.js"></script>
